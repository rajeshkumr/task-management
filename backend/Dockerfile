FROM node:18-alpine
WORKDIR /app

COPY package*.json ./
RUN npm install --frozen-lockfile

ARG DATABASE_TYPE
ARG DATABASE_HOST
ARG DATABASE_NAME
ARG DATABASE_USE_UNIFIED_TOPOLOGY
ARG DATABASE_SYNCHRONIZE
ENV DATABASE_TYPE=$DATABASE_TYPE
ENV DATABASE_HOST=$DATABASE_HOST
ENV DATABASE_NAME=$DATABASE_NAME
ENV DATABASE_USE_UNIFIED_TOPOLOGY=$DATABASE_USE_UNIFIED_TOPOLOGY
ENV DATABASE_SYNCHRONIZE=$DATABASE_SYNCHRONIZE

COPY . .
RUN npm run build

EXPOSE 3001
CMD ["npm", "run", "start:prod"]